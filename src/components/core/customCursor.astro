<div
  id="custom-cursor"
  class="hidden fixed top-0 left-0 pointer-events-none z-9999 mix-blend-difference sm:flex items-center justify-center rounded-full border border-[rgb(255,215,0)] bg-transparent w-6 h-6 will-change-transform"
>
  <span
    id="cursor-text"
    class="text-[14px] font-black text-center text-black opacity-0 uppercase tracking-tighter"
  >
    Ver
  </span>
</div>

<script>
  import gsap from "gsap";

  function initCursor() {
    const cursor = document.getElementById("custom-cursor");
    const cursorText = document.getElementById("cursor-text");
    if (!cursor || !cursorText) return;

    // Seteo inicial: Centralizamos el cursor con GSAP para evitar el desfase del CSS
    gsap.set(cursor, { xPercent: -50, yPercent: -50, scale: 1 });

    const pos = { x: window.innerWidth / 2, y: window.innerHeight / 2 };
    const mouse = { x: pos.x, y: pos.y };
    
    // QuickSetter es la forma más rápida de GSAP para actualizar propiedades (60fps+)
    const xSet = gsap.quickSetter(cursor, "x", "px");
    const ySet = gsap.quickSetter(cursor, "y", "px");

    window.addEventListener("mousemove", (e) => {
      mouse.x = e.clientX;
      mouse.y = e.clientY;
    });

    // Loop de animación independiente del scroll para suavidad máxima
    gsap.ticker.add(() => {
      const dt = 1.0 - Math.pow(1.0 - 0.2, gsap.ticker.deltaRatio());
      pos.x += (mouse.x - pos.x) * dt;
      pos.y += (mouse.y - pos.y) * dt;
      xSet(pos.x);
      ySet(pos.y);
    });

    // Lógica de Hover con GSAP (Adiós a las clases CSS para el transform)
    const handleMouseOver = (e: MouseEvent) => {
      const target = e.target as HTMLElement;
      const isInteractable = target.closest("a, button, article, .hoverable");

      if (isInteractable) {
        gsap.to(cursor, {
          width: 80,
          height: 80,
          backgroundColor: "white",
          borderColor: "transparent",
          duration: 0.4,
          ease: "power3.out"
        });
        gsap.to(cursorText, { opacity: 1, duration: 0.3 });
      } else {
        gsap.to(cursor, {
          width: 18,
          height: 18,
          backgroundColor: "transparent",
          borderColor: "rgb(255,215,0)",
          duration: 0.4,
          ease: "power3.out"
        });
        gsap.to(cursorText, { opacity: 0, duration: 0.3 });
      }
    };

    window.addEventListener("mouseover", handleMouseOver);
  }

  // Reiniciar en cada navegación de Astro
  document.addEventListener("astro:page-load", initCursor);
</script>