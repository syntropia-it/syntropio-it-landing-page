---
import { Image } from 'astro:assets';
import iso from '../../assets/iso.png';
import { Menu, X } from 'lucide-astro';

const navLinks = [
    { name: 'Servicios', href: '/servicios' },
    { name: 'Proyectos', href: '/proyectos' },
    { name: 'Blog', href: '/blog' },
    { name: 'Nosotros', href: '/nosotros' },
];
---

<nav
    id="navbar"
    class="fixed top-0 w-full z-9999 px-6 py-6 flex justify-between items-center transition-all duration-500 mix-blend-difference text-white"
    data-navbar
>
    <a
        href="/"
        class="text-2xl sm:text-3xl font-bold tracking-tighter flex items-center gap-2 group z-100"
    >
        <Image src={iso} alt="Samana Logo" width={150} height={150} loading="eager" fetchpriority="high" class="w-12 h-12" />
        <span class="transition-colors duration-300 group-hover:text-[rgb(255,215,0)]">SAMANA</span>
    </a>

    <button
        id="mobile-menu-btn"
        aria-label="Abrir menú de navegación"
        aria-expanded="false"
        aria-controls="mobile-menu"
        class="md:hidden z-100 relative w-12 h-12 flex items-center justify-center"
    >
        <Menu
            size={32}
            id="icon-menu"
            aria-hidden="true"
            class="absolute transition-all duration-500"
        />
        <X
            size={32}
            id="icon-close"
            aria-hidden="true"
            class="absolute transition-all duration-500 opacity-0 rotate-180deg scale-50"
        />
    </button>

    <div class="hidden md:flex gap-6 text-lg font-medium items-center tracking-wide text-gray-300">
        {
            navLinks.map(link => (
                <a href={link.href} class="hover:text-white transition-colors duration-300">
                    {link.name}
                </a>
            ))
        }
        <a
            href="/contacto"
            class="transition-colors border border-white/20 px-5 py-2.5 rounded-full hover:border-yellow-400 hover:text-yellow-400"
            >COTIZA</a
        >
    </div>

    <div
        id="mobile-menu"
        role="dialog"
        aria-modal="true"
        aria-label="Menú principal de navegación"
        class="fixed top-0 left-0 w-full h-screen bg-black flex flex-col items-center justify-center gap-8 text-3xl font-light z-90 pointer-events-none"
    >
        {
            navLinks.map((link, index) => (
                <a
                    href={link.href}
                    class="mobile-link opacity-0 translate-y-4 hover:text-yellow-400 transition-all duration-300"
                    style={`--delay: ${index * 0.15}s`}
                >
                    {link.name}
                </a>
            ))
        }
        <a
            href="/contacto"
            class="mobile-link opacity-0 translate-y-4 mt-4 border border-white/20 px-8 py-3 rounded-full text-xl"
            style={`--delay: ${navLinks.length * 0.2}s`}
        >
            COTIZA
        </a>
    </div>
</nav>

<script>
    function setupNavbar() {
        const navbar = document.querySelector('[data-navbar]');
        const btn = document.getElementById('mobile-menu-btn');
        const menu = document.getElementById('mobile-menu');
        const iconMenu = document.getElementById('icon-menu');
        const iconClose = document.getElementById('icon-close');
        const links = document.querySelectorAll('.mobile-link');

        let isOpen = false;

        function toggle() {
            isOpen = !isOpen;
            if (!menu || !iconMenu || !iconClose || !navbar) return;

            if (isOpen) {
                // ABRIR
                menu.style.pointerEvents = 'auto';
                menu.classList.add('menu-open');

                // Iconos
                iconMenu.classList.add('opacity-0', 'rotate-[-180deg]', 'scale-50');
                iconClose.classList.remove('opacity-0', 'rotate-[180deg]', 'scale-50');
                iconClose.classList.add('rotate-0', 'scale-100');

                navbar.classList.remove('mix-blend-difference');
                document.body.style.overflow = 'hidden';
            } else {
                // CERRAR
                menu.style.pointerEvents = 'none';
                menu.classList.remove('menu-open');

                // Iconos
                iconMenu.classList.remove('opacity-0', 'rotate-[-180deg]', 'scale-50');
                iconClose.classList.add('opacity-0', 'rotate-[180deg]', 'scale-50');
                iconClose.classList.remove('rotate-0', 'scale-100');

                document.body.style.overflow = '';

                setTimeout(() => {
                    if (window.scrollY < 100 && !isOpen) {
                        navbar.classList.add('mix-blend-difference');
                    }
                }, 600);
            }
        }

        btn?.addEventListener('click', toggle);
        links.forEach(l => l.addEventListener('click', toggle));

        // Scroll
        window.addEventListener(
            'scroll',
            () => {
                if (!navbar) return;
                if (window.scrollY > 200 || isOpen) {
                    navbar.classList.add('bg-black/70', 'backdrop-blur-md', 'py-4');
                    navbar.classList.remove('mix-blend-difference', 'py-6');
                } else {
                    navbar.classList.remove('bg-black/70', 'backdrop-blur-md', 'py-4');
                    navbar.classList.add('mix-blend-difference', 'py-6');
                }
            },
            { passive: true }
        );
    }

    setupNavbar();
    document.addEventListener('astro:after-swap', setupNavbar);
</script>

<style>
    /* Efecto Péndulo / Abanico */
    #mobile-menu {
        transform-origin: top left;
        transform: rotate(-100deg);
        transition: transform 0.7s cubic-bezier(0.86, 0, 0.07, 1);
        isolation: isolate;
    }

    #mobile-menu.menu-open {
        transform: rotate(0deg);
    }

    /* Animación de los links */
    .mobile-link {
        transition:
            opacity 0.4s ease,
            transform 0.4s ease;
        transition-delay: 0s;
    }

    #mobile-menu.menu-open .mobile-link {
        opacity: 1;
        transform: translateY(0);

        transition-delay: calc(var(--delay) + 0.4s);
    }

    #mobile-menu:not(.menu-open) .mobile-link {
        opacity: 0;
        transform: translateY(10px);
        transition:
            opacity 0.2s ease,
            transform 0.2s ease;
    }
</style>
